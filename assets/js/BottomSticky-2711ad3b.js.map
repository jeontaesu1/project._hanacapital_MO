{"version":3,"file":"BottomSticky-2711ad3b.js","sources":["../../../../src/components/ui/common/BottomSticky.vue"],"sourcesContent":["<script>\nimport {\n  ref,\n  reactive,\n  computed,\n  onMounted,\n  onBeforeUnmount,\n  nextTick,\n  inject,\n} from 'vue';\n\nimport { useUiCommonStore } from '@/stores/ui/common';\nimport { useUiScrollBlockStore } from '@/stores/ui/scrollBlock';\n\nconst defaultClassNames = () => ({\n  wrap: '',\n  contents: '',\n  fake: '',\n});\n\nexport default {\n  props: {\n    classNames: {\n      Type: Object,\n      default() {\n        return defaultClassNames();\n      },\n    },\n  },\n  setup(props) {\n    const pageContents = inject('pageContents', {});\n\n    const store = {\n      ui: {\n        common: useUiCommonStore(),\n        scrollBlock: useUiScrollBlockStore(),\n      },\n    };\n\n    const state = reactive({\n      isSticky: false,\n      marginTop: '0',\n      marginBottom: '0',\n      height: '0',\n    });\n\n    const wrap = ref(null);\n    const contents = ref(null);\n    const fake = ref(null);\n\n    const customClassNames = computed(() => {\n      const { classNames } = props;\n      return Object.assign(defaultClassNames(), classNames);\n    });\n\n    const setMargin = () => {\n      const contentsEl = contents.value;\n      const contentsInnerEl = contentsEl.children[0];\n      const contentsInnerStyles = getComputedStyle(contentsInnerEl);\n      const marginTop = contentsInnerStyles.getPropertyValue('margin-top');\n      const marginBottom =\n        contentsInnerStyles.getPropertyValue('margin-bottom');\n\n      state.marginTop = marginTop;\n      state.marginBottom = marginBottom;\n    };\n\n    const update = () => {\n      const wrapEl = wrap.value;\n\n      if (wrapEl.offsetHeight <= 0) return;\n\n      const contentsEl = contents.value;\n      const contentsInnerEl = contentsEl.children[0];\n      const scrollTop = (() => {\n        if (store.ui.scrollBlock.isBlocking) {\n          return store.ui.scrollBlock.scrollTop;\n        } else {\n          const html = document.getElementsByTagName('html')[0];\n          return html.scrollTop;\n        }\n      })();\n      const offsetTop = scrollTop + wrapEl.getBoundingClientRect().top;\n      const height = contentsInnerEl.offsetHeight;\n      const winHeight = window.innerHeight;\n\n      if (\n        store.ui.common.keypadOpened ||\n        scrollTop >= offsetTop + height - winHeight\n      ) {\n        if (state.isSticky) {\n          state.isSticky = false;\n        }\n        return;\n      }\n\n      state.height = `${height}px`;\n\n      if (!state.isSticky) {\n        state.isSticky = true;\n      }\n    };\n\n    const scroll = () => {\n      update();\n    };\n\n    const resize = () => {\n      update();\n    };\n\n    const load = () => {\n      update();\n    };\n\n    const keypadOpened = () => {\n      update();\n    };\n\n    const keypadClosed = () => {\n      update();\n    };\n\n    onMounted(() => {\n      setMargin();\n\n      nextTick(() => {\n        update();\n      });\n\n      window.addEventListener('load', load);\n      window.addEventListener('scroll', scroll);\n      window.addEventListener('resize', resize);\n      window.addEventListener('keypadOpened', keypadOpened);\n      window.addEventListener('keypadClosed', keypadClosed);\n\n      if (pageContents.wrap && pageContents.wrap.value) {\n        pageContents.wrap.value.addEventListener('resize', resize);\n      }\n    });\n\n    onBeforeUnmount(() => {\n      window.removeEventListener('load', load);\n      window.removeEventListener('scroll', scroll);\n      window.removeEventListener('resize', resize);\n      window.removeEventListener('keypadOpened', keypadOpened);\n      window.removeEventListener('keypadClosed', keypadClosed);\n\n      if (pageContents.wrap && pageContents.wrap.value) {\n        pageContents.wrap.value.removeEventListener('resize', resize);\n      }\n    });\n\n    return {\n      state,\n      wrap,\n      contents,\n      fake,\n      customClassNames,\n    };\n  },\n};\n</script>\n\n<template>\n  <div ref=\"wrap\" :class=\"customClassNames.wrap\">\n    <div\n      ref=\"contents\"\n      :style=\"{\n        position: state.isSticky ? 'fixed' : 'static',\n        bottom: state.isSticky ? '0' : null,\n        left: state.isSticky ? '0' : null,\n        width: state.isSticky ? '100%' : null,\n        zIndex: state.isSticky ? '1000' : null,\n        transform: 'translateZ(0)',\n        transition: 'transform 0s',\n      }\"\n      :class=\"[\n        {\n          'is-sticky': state.isSticky,\n        },\n        customClassNames.contents,\n      ]\"\n    >\n      <slot :isSticky=\"state.isSticky\" />\n    </div>\n    <div\n      :class=\"customClassNames.fake\"\n      :style=\"{\n        display: state.isSticky ? 'block' : 'none',\n        marginTop: state.marginTop,\n        marginBottom: state.marginBottom,\n        height: state.height,\n      }\"\n    ></div>\n  </div>\n</template>\n"],"names":["defaultClassNames","_sfc_main","props","pageContents","inject","store","useUiCommonStore","useUiScrollBlockStore","state","reactive","wrap","ref","contents","fake","customClassNames","computed","classNames","setMargin","contentsInnerEl","contentsInnerStyles","marginTop","marginBottom","update","wrapEl","scrollTop","offsetTop","height","winHeight","scroll","resize","load","keypadOpened","keypadClosed","onMounted","nextTick","onBeforeUnmount","_createElementBlock","_normalizeClass","$setup","_createElementVNode","_normalizeStyle","_renderSlot","_ctx"],"mappings":"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"}