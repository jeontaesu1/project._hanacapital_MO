import{_ as M,o as V,l as O}from"./index-cf777a32.js";import{d as P,w as T,r as R,a as k,c as h,s as Z,o as q,j as A,b as D,p as F,e as G,f as J,g as b,h as Q,i as L,n as g}from"./vendor-ba129e39.js";const W=P("uiSticky",{state:()=>({items:[],count:1}),actions:{add(i=0){const n=this.count;return this.items.push({key:n,height:i}),this.count++,n},remove(i){const n=this.items.findIndex(e=>e.key===i);this.items.splice(n,1)},update(i,n=0){const e=this.items.findIndex(t=>t.key===i);this.items[e].height!==n&&(this.items[e].height=n)}}}),K=()=>({wrap:"",contents:"",fake:""}),X={props:{classNames:{Type:Object,default(){return K()}}},setup(i){const n=T("uiLayer",{}),e=T("popupLayout",{}),t={ui:{scrollBlock:V(),header:O(),sticky:W()}},s=R({isSticky:!1,marginTop:"0",marginBottom:"0",height:"0",storeKey:null}),d=k(null),y=k(null),x=k(null),N=h(()=>{const{classNames:o}=i;return Object.assign(K(),o)}),v=h(()=>{const o=e&&e.head&&e.head.value;return(()=>o?o.offsetHeight:0)()||t.ui.header.height}),C=h(()=>S()),S=()=>{const{items:o}=t.ui.sticky;let c=0;if(s.storeKey)for(let r=0;r<o.length&&o[r].key!==s.storeKey;r++)c+=o[r].height;return c},_=()=>{const c=y.value.children[0],r=getComputedStyle(c),m=r.getPropertyValue("margin-top"),a=r.getPropertyValue("margin-bottom");s.marginTop=m,s.marginBottom=a},l=()=>{const o=d.value;if(o.offsetHeight<=0)return;const c=document.getElementsByTagName("html")[0],m=y.value.children[0],a=e&&e.body&&e.body.value,E=v.value,H=c.scrollTop,p=(()=>a?a.scrollTop+E:t.ui.scrollBlock.isBlocking?t.ui.scrollBlock.scrollTop:H)(),j=(a?p+H:p)+o.getBoundingClientRect().top,U=S(),f=m.offsetHeight;if(a?s.storeKey&&(t.ui.sticky.remove(s.storeKey),s.storeKey=null):s.storeKey?t.ui.sticky.update(s.storeKey,f):s.storeKey=t.ui.sticky.add(f),p<=j-E-U){s.isSticky&&(s.isSticky=!1);return}s.height=`${f}px`,s.isSticky||(s.isSticky=!0)},u=()=>{l()},B=()=>{l()},w=()=>{l()},z=()=>{const o=e&&e.body&&e.body.value;o&&o.addEventListener("scroll",u)},I=()=>d.value;return Z(()=>{n&&n.stickyBar&&(n.stickyBar.value={update:l},e.stickyBar.value={scrollBind:z})}),q(()=>{_(),A(()=>{l()}),window.addEventListener("load",w),window.addEventListener("scroll",u),window.addEventListener("resize",B)}),D(()=>{s.storeKey&&t.ui.sticky.remove(s.storeKey),window.removeEventListener("load",w),window.removeEventListener("scroll",u),window.removeEventListener("resize",B);const o=e&&e.body&&e.body.value;o&&o.removeEventListener("scroll",u)}),F("stickyBar",{getElement:I}),{state:s,wrap:d,contents:y,fake:x,customClassNames:N,headerH:v,stickyH:C}}};function Y(i,n,e,t,s,d){return G(),J("div",{ref:"wrap",class:g(t.customClassNames.wrap)},[b("div",{ref:"contents",style:L({position:t.state.isSticky?"fixed":"static",top:t.state.isSticky?`${t.headerH+t.stickyH}px`:null,left:t.state.isSticky?"0":null,width:t.state.isSticky?"100%":null,zIndex:t.state.isSticky?"1000":null,transform:"translateZ(0)",transition:"transform 0s"}),class:g([{"is-sticky":t.state.isSticky},t.customClassNames.contents])},[Q(i.$slots,"default",{isSticky:t.state.isSticky})],6),b("div",{class:g(t.customClassNames.fake),style:L({display:t.state.isSticky?"block":"none",marginTop:t.state.marginTop,marginBottom:t.state.marginBottom,height:t.state.height})},null,6)],2)}const et=M(X,[["render",Y]]);export{et as S};
//# sourceMappingURL=StickyBar-8ff57e3b.js.map
